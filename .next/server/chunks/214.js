"use strict";exports.id=214,exports.ids=[214],exports.modules={214:(a,b,c)=>{c.d(b,{Q:()=>cB});var d=c(7598);let e=d.webcrypto?.subtle||{};var f=Object.defineProperty;((a,b)=>{for(var c in b)f(a,c,{get:b[c],enumerable:!0})})({},{UpstashError:()=>g,UrlError:()=>h});var g=class extends Error{constructor(a){super(a),this.name="UpstashError"}},h=class extends Error{constructor(a){super(`Upstash Redis client was passed an invalid URL. You should pass a URL starting with https. Received: "${a}". `),this.name="UrlError"}};function i(a){try{return function a(b){let c=Array.isArray(b)?b.map(b=>{try{return a(b)}catch{return b}}):JSON.parse(b);return"number"==typeof c&&c.toString()!==b?b:c}(a)}catch{return a}}function j(a){return[a[0],...i(a.slice(1))]}function k(a){let[b,c]=a,d=[];for(let a=0;a<c.length;a+=2)d.push({key:c[a],type:c[a+1]});return[b,d]}var l=class{baseUrl;headers;options;readYourWrites;upstashSyncToken="";hasCredentials;retry;constructor(a){if(this.options={backend:a.options?.backend,agent:a.agent,responseEncoding:a.responseEncoding??"base64",cache:a.cache,signal:a.signal,keepAlive:a.keepAlive??!0},this.upstashSyncToken="",this.readYourWrites=a.readYourWrites??!0,this.baseUrl=(a.baseUrl||"").replace(/\/$/,""),this.baseUrl&&!/^https?:\/\/[^\s#$./?].\S*$/.test(this.baseUrl))throw new h(this.baseUrl);this.headers={"Content-Type":"application/json",...a.headers},this.hasCredentials=!!(this.baseUrl&&this.headers.authorization.split(" ")[1]),"base64"===this.options.responseEncoding&&(this.headers["Upstash-Encoding"]="base64"),this.retry="boolean"!=typeof a.retry||a.retry?{attempts:a.retry?.retries??5,backoff:a.retry?.backoff??(a=>50*Math.exp(a))}:{attempts:1,backoff:()=>0}}mergeTelemetry(a){this.headers=o(this.headers,"Upstash-Telemetry-Runtime",a.runtime),this.headers=o(this.headers,"Upstash-Telemetry-Platform",a.platform),this.headers=o(this.headers,"Upstash-Telemetry-Sdk",a.sdk)}async request(a){let b=function(...a){let b={};for(let c of a)if(c)for(let[a,d]of Object.entries(c))null!=d&&(b[a]=d);return b}(this.headers,a.headers??{}),c=[this.baseUrl,...a.path??[]].join("/"),d="text/event-stream"===b.Accept,e=a.signal??this.options.signal,f="function"==typeof e,h={cache:this.options.cache,method:"POST",headers:b,body:JSON.stringify(a.body),keepalive:this.options.keepAlive,agent:this.options.agent,signal:f?e():e,backend:this.options.backend};if(this.hasCredentials||console.warn("[Upstash Redis] Redis client was initialized without url or token. Failed to execute command."),this.readYourWrites){let a=this.upstashSyncToken;this.headers["upstash-sync-token"]=a}let i=null,j=null;for(let a=0;a<=this.retry.attempts;a++)try{i=await fetch(c,h);break}catch(b){if(h.signal?.aborted&&f)throw b;if(h.signal?.aborted){i=new Response(new Blob([JSON.stringify({result:h.signal.reason??"Aborted"})]),{status:200,statusText:h.signal.reason??"Aborted"});break}j=b,a<this.retry.attempts&&await new Promise(b=>setTimeout(b,this.retry.backoff(a)))}if(!i)throw j??Error("Exhausted all retries");if(!i.ok){let b=await i.json();throw new g(`${b.error}, command was: ${JSON.stringify(a.body)}`)}if(this.readYourWrites){let a=i.headers;this.upstashSyncToken=a.get("upstash-sync-token")??""}if(d&&a&&a.onMessage&&i.body){let b=i.body.getReader(),c=new TextDecoder;return(async()=>{try{for(;;){let{value:d,done:e}=await b.read();if(e)break;for(let b of c.decode(d).split("\n"))if(b.startsWith("data: ")){let c=b.slice(6);a.onMessage?.(c)}}}catch(a){a instanceof Error&&"AbortError"===a.name||console.error("Stream reading error:",a)}finally{try{await b.cancel()}catch{}}})(),{result:1}}let k=await i.json();if(this.readYourWrites){let a=i.headers;this.upstashSyncToken=a.get("upstash-sync-token")??""}return"base64"===this.options.responseEncoding?Array.isArray(k)?k.map(({result:a,error:b})=>({result:n(a),error:b})):{result:n(k.result),error:k.error}:k}};function m(a){let b="";try{let c=atob(a),d=c.length,e=new Uint8Array(d);for(let a=0;a<d;a++)e[a]=c.charCodeAt(a);b=new TextDecoder().decode(e)}catch{b=a}return b}function n(a){let b;switch(typeof a){case"undefined":return a;case"number":b=a;break;case"object":b=Array.isArray(a)?a.map(a=>"string"==typeof a?m(a):Array.isArray(a)?a.map(a=>n(a)):a):null;break;case"string":b="OK"===a?"OK":m(a)}return b}function o(a,b,c){return c&&(a[b]=a[b]?[a[b],c].join(","):c),a}var p=a=>{switch(typeof a){case"string":case"number":case"boolean":return a;default:return JSON.stringify(a)}},q=class{command;serialize;deserialize;headers;path;onMessage;isStreaming;signal;constructor(a,b){if(this.serialize=p,this.deserialize=b?.automaticDeserialization===void 0||b.automaticDeserialization?b?.deserialize??i:a=>a,this.command=a.map(a=>this.serialize(a)),this.headers=b?.headers,this.path=b?.path,this.onMessage=b?.streamOptions?.onMessage,this.isStreaming=b?.streamOptions?.isStreaming??!1,this.signal=b?.streamOptions?.signal,b?.latencyLogging){let a=this.exec.bind(this);this.exec=async b=>{let c=performance.now(),d=await a(b),e=(performance.now()-c).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.command[0].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${e} ms\x1b[0m`),d}}}async exec(a){let{result:b,error:c}=await a.request({body:this.command,path:this.path,upstashSyncToken:a.upstashSyncToken,headers:this.headers,onMessage:this.onMessage,isStreaming:this.isStreaming,signal:this.signal});if(c)throw new g(c);if(void 0===b)throw TypeError("Request did not return a result");return this.deserialize(b)}},r=class extends q{constructor(a,b){let c=["hrandfield",a[0]];"number"==typeof a[1]&&c.push(a[1]),a[2]&&c.push("WITHVALUES"),super(c,{deserialize:a[2]?a=>(function(a){if(0===a.length)return null;let b={};for(let c=0;c<a.length;c+=2){let d=a[c],e=a[c+1];try{b[d]=JSON.parse(e)}catch{b[d]=e}}return b})(a):b?.deserialize,...b})}},s=class extends q{constructor(a,b){super(["append",...a],b)}},t=class extends q{constructor([a,b,c],d){let e=["bitcount",a];"number"==typeof b&&e.push(b),"number"==typeof c&&e.push(c),super(e,d)}},u=class{constructor(a,b,c,d=a=>a.exec(this.client)){this.client=b,this.opts=c,this.execOperation=d,this.command=["bitfield",...a]}command;chain(...a){return this.command.push(...a),this}get(...a){return this.chain("get",...a)}set(...a){return this.chain("set",...a)}incrby(...a){return this.chain("incrby",...a)}overflow(a){return this.chain("overflow",a)}exec(){let a=new q(this.command,this.opts);return this.execOperation(a)}},v=class extends q{constructor(a,b){super(["bitop",...a],b)}},w=class extends q{constructor(a,b){super(["bitpos",...a],b)}},x=class extends q{constructor([a,b,c],d){super(["COPY",a,b,...c?.replace?["REPLACE"]:[]],{...d,deserialize:a=>a>0?"COPIED":"NOT_COPIED"})}},y=class extends q{constructor(a){super(["dbsize"],a)}},z=class extends q{constructor(a,b){super(["decr",...a],b)}},A=class extends q{constructor(a,b){super(["decrby",...a],b)}},B=class extends q{constructor(a,b){super(["del",...a],b)}},C=class extends q{constructor(a,b){super(["echo",...a],b)}},D=class extends q{constructor([a,b,c],d){super(["eval_ro",a,b.length,...b,...c??[]],d)}},E=class extends q{constructor([a,b,c],d){super(["eval",a,b.length,...b,...c??[]],d)}},F=class extends q{constructor([a,b,c],d){super(["evalsha_ro",a,b.length,...b,...c??[]],d)}},G=class extends q{constructor([a,b,c],d){super(["evalsha",a,b.length,...b,...c??[]],d)}},H=class extends q{constructor(a,b){super(a.map(a=>"string"==typeof a?a:String(a)),b)}},I=class extends q{constructor(a,b){super(["exists",...a],b)}},J=class extends q{constructor(a,b){super(["expire",...a.filter(Boolean)],b)}},K=class extends q{constructor(a,b){super(["expireat",...a],b)}},L=class extends q{constructor(a,b){let c=["flushall"];a&&a.length>0&&a[0].async&&c.push("async"),super(c,b)}},M=class extends q{constructor([a],b){let c=["flushdb"];a?.async&&c.push("async"),super(c,b)}},N=class extends q{constructor([a,b,...c],d){let e=["geoadd",a];"nx"in b&&b.nx?e.push("nx"):"xx"in b&&b.xx&&e.push("xx"),"ch"in b&&b.ch&&e.push("ch"),"latitude"in b&&b.latitude&&e.push(b.longitude,b.latitude,b.member),e.push(...c.flatMap(({latitude:a,longitude:b,member:c})=>[b,a,c])),super(e,d)}},O=class extends q{constructor([a,b,c,d="M"],e){super(["GEODIST",a,b,c,d],e)}},P=class extends q{constructor(a,b){let[c]=a;super(["GEOHASH",c,...Array.isArray(a[1])?a[1]:a.slice(1)],b)}},Q=class extends q{constructor(a,b){let[c]=a;super(["GEOPOS",c,...Array.isArray(a[1])?a[1]:a.slice(1)],{deserialize:a=>(function(a){let b=[];for(let c of a)c?.[0]&&c?.[1]&&b.push({lng:Number.parseFloat(c[0]),lat:Number.parseFloat(c[1])});return b})(a),...b})}},R=class extends q{constructor([a,b,c,d,e],f){let g=["GEOSEARCH",a];("FROMMEMBER"===b.type||"frommember"===b.type)&&g.push(b.type,b.member),("FROMLONLAT"===b.type||"fromlonlat"===b.type)&&g.push(b.type,b.coordinate.lon,b.coordinate.lat),("BYRADIUS"===c.type||"byradius"===c.type)&&g.push(c.type,c.radius,c.radiusType),("BYBOX"===c.type||"bybox"===c.type)&&g.push(c.type,c.rect.width,c.rect.height,c.rectType),g.push(d),e?.count&&g.push("COUNT",e.count.limit,...e.count.any?["ANY"]:[]),super([...g,...e?.withCoord?["WITHCOORD"]:[],...e?.withDist?["WITHDIST"]:[],...e?.withHash?["WITHHASH"]:[]],{deserialize:a=>e?.withCoord||e?.withDist||e?.withHash?a.map(a=>{let b=1,c={};try{c.member=JSON.parse(a[0])}catch{c.member=a[0]}return e.withDist&&(c.dist=Number.parseFloat(a[b++])),e.withHash&&(c.hash=a[b++].toString()),e.withCoord&&(c.coord={long:Number.parseFloat(a[b][0]),lat:Number.parseFloat(a[b][1])}),c}):a.map(a=>{try{return{member:JSON.parse(a)}}catch{return{member:a}}}),...f})}},S=class extends q{constructor([a,b,c,d,e,f],g){let h=["GEOSEARCHSTORE",a,b];("FROMMEMBER"===c.type||"frommember"===c.type)&&h.push(c.type,c.member),("FROMLONLAT"===c.type||"fromlonlat"===c.type)&&h.push(c.type,c.coordinate.lon,c.coordinate.lat),("BYRADIUS"===d.type||"byradius"===d.type)&&h.push(d.type,d.radius,d.radiusType),("BYBOX"===d.type||"bybox"===d.type)&&h.push(d.type,d.rect.width,d.rect.height,d.rectType),h.push(e),f?.count&&h.push("COUNT",f.count.limit,...f.count.any?["ANY"]:[]),super([...h,...f?.storeDist?["STOREDIST"]:[]],g)}},T=class extends q{constructor(a,b){super(["get",...a],b)}},U=class extends q{constructor(a,b){super(["getbit",...a],b)}},V=class extends q{constructor(a,b){super(["getdel",...a],b)}},W=class extends q{constructor([a,b],c){let d=["getex",a];b&&("ex"in b&&"number"==typeof b.ex?d.push("ex",b.ex):"px"in b&&"number"==typeof b.px?d.push("px",b.px):"exat"in b&&"number"==typeof b.exat?d.push("exat",b.exat):"pxat"in b&&"number"==typeof b.pxat?d.push("pxat",b.pxat):"persist"in b&&b.persist&&d.push("persist")),super(d,c)}},X=class extends q{constructor(a,b){super(["getrange",...a],b)}},Y=class extends q{constructor(a,b){super(["getset",...a],b)}},Z=class extends q{constructor(a,b){super(["hdel",...a],b)}},$=class extends q{constructor(a,b){super(["hexists",...a],b)}},_=class extends q{constructor(a,b){let[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hexpire",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},aa=class extends q{constructor(a,b){let[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hexpireat",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},ab=class extends q{constructor(a,b){let[c,d]=a,e=Array.isArray(d)?d:[d];super(["hexpiretime",c,"FIELDS",e.length,...e],b)}},ac=class extends q{constructor(a,b){let[c,d]=a,e=Array.isArray(d)?d:[d];super(["hpersist",c,"FIELDS",e.length,...e],b)}},ad=class extends q{constructor(a,b){let[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hpexpire",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},ae=class extends q{constructor(a,b){let[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hpexpireat",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},af=class extends q{constructor(a,b){let[c,d]=a,e=Array.isArray(d)?d:[d];super(["hpexpiretime",c,"FIELDS",e.length,...e],b)}},ag=class extends q{constructor(a,b){let[c,d]=a,e=Array.isArray(d)?d:[d];super(["hpttl",c,"FIELDS",e.length,...e],b)}},ah=class extends q{constructor(a,b){super(["hget",...a],b)}},ai=class extends q{constructor(a,b){super(["hgetall",...a],{deserialize:a=>(function(a){if(0===a.length)return null;let b={};for(let c=0;c<a.length;c+=2){let d=a[c],e=a[c+1];try{let a=!Number.isNaN(Number(e))&&!Number.isSafeInteger(Number(e));b[d]=a?e:JSON.parse(e)}catch{b[d]=e}}return b})(a),...b})}},aj=class extends q{constructor(a,b){super(["hincrby",...a],b)}},ak=class extends q{constructor(a,b){super(["hincrbyfloat",...a],b)}},al=class extends q{constructor([a],b){super(["hkeys",a],b)}},am=class extends q{constructor(a,b){super(["hlen",...a],b)}},an=class extends q{constructor([a,...b],c){super(["hmget",a,...b],{deserialize:a=>(function(a,b){if(b.every(a=>null===a))return null;let c={};for(let[d,e]of a.entries())try{c[e]=JSON.parse(b[d])}catch{c[e]=b[d]}return c})(b,a),...c})}},ao=class extends q{constructor([a,b],c){super(["hmset",a,...Object.entries(b).flatMap(([a,b])=>[a,b])],c)}},ap=class extends q{constructor([a,b,c],d){let e=["hscan",a,b];c?.match&&e.push("match",c.match),"number"==typeof c?.count&&e.push("count",c.count),super(e,{deserialize:j,...d})}},aq=class extends q{constructor([a,b],c){super(["hset",a,...Object.entries(b).flatMap(([a,b])=>[a,b])],c)}},ar=class extends q{constructor(a,b){super(["hsetnx",...a],b)}},as=class extends q{constructor(a,b){super(["hstrlen",...a],b)}},at=class extends q{constructor(a,b){let[c,d]=a,e=Array.isArray(d)?d:[d];super(["httl",c,"FIELDS",e.length,...e],b)}},au=class extends q{constructor(a,b){super(["hvals",...a],b)}},av=class extends q{constructor(a,b){super(["incr",...a],b)}},aw=class extends q{constructor(a,b){super(["incrby",...a],b)}},ax=class extends q{constructor(a,b){super(["incrbyfloat",...a],b)}},ay=class extends q{constructor(a,b){super(["JSON.ARRAPPEND",...a],b)}},az=class extends q{constructor(a,b){super(["JSON.ARRINDEX",...a],b)}},aA=class extends q{constructor(a,b){super(["JSON.ARRINSERT",...a],b)}},aB=class extends q{constructor(a,b){super(["JSON.ARRLEN",a[0],a[1]??"$"],b)}},aC=class extends q{constructor(a,b){super(["JSON.ARRPOP",...a],b)}},aD=class extends q{constructor(a,b){let c=a[1]??"$";super(["JSON.ARRTRIM",a[0],c,a[2]??0,a[3]??0],b)}},aE=class extends q{constructor(a,b){super(["JSON.CLEAR",...a],b)}},aF=class extends q{constructor(a,b){super(["JSON.DEL",...a],b)}},aG=class extends q{constructor(a,b){super(["JSON.FORGET",...a],b)}},aH=class extends q{constructor(a,b){let c=["JSON.GET"];"string"==typeof a[1]?c.push(...a):(c.push(a[0]),a[1]&&(a[1].indent&&c.push("INDENT",a[1].indent),a[1].newline&&c.push("NEWLINE",a[1].newline),a[1].space&&c.push("SPACE",a[1].space)),c.push(...a.slice(2))),super(c,b)}},aI=class extends q{constructor(a,b){super(["JSON.MERGE",...a],b)}},aJ=class extends q{constructor(a,b){super(["JSON.MGET",...a[0],a[1]],b)}},aK=class extends q{constructor(a,b){let c=["JSON.MSET"];for(let b of a)c.push(b.key,b.path,b.value);super(c,b)}},aL=class extends q{constructor(a,b){super(["JSON.NUMINCRBY",...a],b)}},aM=class extends q{constructor(a,b){super(["JSON.NUMMULTBY",...a],b)}},aN=class extends q{constructor(a,b){super(["JSON.OBJKEYS",...a],b)}},aO=class extends q{constructor(a,b){super(["JSON.OBJLEN",...a],b)}},aP=class extends q{constructor(a,b){super(["JSON.RESP",...a],b)}},aQ=class extends q{constructor(a,b){let c=["JSON.SET",a[0],a[1],a[2]];a[3]&&(a[3].nx?c.push("NX"):a[3].xx&&c.push("XX")),super(c,b)}},aR=class extends q{constructor(a,b){super(["JSON.STRAPPEND",...a],b)}},aS=class extends q{constructor(a,b){super(["JSON.STRLEN",...a],b)}},aT=class extends q{constructor(a,b){super(["JSON.TOGGLE",...a],b)}},aU=class extends q{constructor(a,b){super(["JSON.TYPE",...a],b)}},aV=class extends q{constructor(a,b){super(["keys",...a],b)}},aW=class extends q{constructor(a,b){super(["lindex",...a],b)}},aX=class extends q{constructor(a,b){super(["linsert",...a],b)}},aY=class extends q{constructor(a,b){super(["llen",...a],b)}},aZ=class extends q{constructor(a,b){super(["lmove",...a],b)}},a$=class extends q{constructor(a,b){let[c,d,e,f]=a;super(["LMPOP",c,...d,e,...f?["COUNT",f]:[]],b)}},a_=class extends q{constructor(a,b){super(["lpop",...a],b)}},a0=class extends q{constructor(a,b){let c=["lpos",a[0],a[1]];"number"==typeof a[2]?.rank&&c.push("rank",a[2].rank),"number"==typeof a[2]?.count&&c.push("count",a[2].count),"number"==typeof a[2]?.maxLen&&c.push("maxLen",a[2].maxLen),super(c,b)}},a1=class extends q{constructor(a,b){super(["lpush",...a],b)}},a2=class extends q{constructor(a,b){super(["lpushx",...a],b)}},a3=class extends q{constructor(a,b){super(["lrange",...a],b)}},a4=class extends q{constructor(a,b){super(["lrem",...a],b)}},a5=class extends q{constructor(a,b){super(["lset",...a],b)}},a6=class extends q{constructor(a,b){super(["ltrim",...a],b)}},a7=class extends q{constructor(a,b){super(["mget",...Array.isArray(a[0])?a[0]:a],b)}},a8=class extends q{constructor([a],b){super(["mset",...Object.entries(a).flatMap(([a,b])=>[a,b])],b)}},a9=class extends q{constructor([a],b){super(["msetnx",...Object.entries(a).flat()],b)}},ba=class extends q{constructor(a,b){super(["persist",...a],b)}},bb=class extends q{constructor(a,b){super(["pexpire",...a],b)}},bc=class extends q{constructor(a,b){super(["pexpireat",...a],b)}},bd=class extends q{constructor(a,b){super(["pfadd",...a],b)}},be=class extends q{constructor(a,b){super(["pfcount",...a],b)}},bf=class extends q{constructor(a,b){super(["pfmerge",...a],b)}},bg=class extends q{constructor(a,b){let c=["ping"];a?.[0]!==void 0&&c.push(a[0]),super(c,b)}},bh=class extends q{constructor(a,b){super(["psetex",...a],b)}},bi=class extends q{constructor(a,b){super(["pttl",...a],b)}},bj=class extends q{constructor(a,b){super(["publish",...a],b)}},bk=class extends q{constructor(a){super(["randomkey"],a)}},bl=class extends q{constructor(a,b){super(["rename",...a],b)}},bm=class extends q{constructor(a,b){super(["renamenx",...a],b)}},bn=class extends q{constructor(a,b){super(["rpop",...a],b)}},bo=class extends q{constructor(a,b){super(["rpush",...a],b)}},bp=class extends q{constructor(a,b){super(["rpushx",...a],b)}},bq=class extends q{constructor(a,b){super(["sadd",...a],b)}},br=class extends q{constructor([a,b],c){let d=["scan",a];b?.match&&d.push("match",b.match),"number"==typeof b?.count&&d.push("count",b.count),b&&"withType"in b&&!0===b.withType?d.push("withtype"):b&&"type"in b&&b.type&&b.type.length>0&&d.push("type",b.type),super(d,{deserialize:b?.withType?k:j,...c})}},bs=class extends q{constructor(a,b){super(["scard",...a],b)}},bt=class extends q{constructor(a,b){super(["script","exists",...a],{deserialize:a=>a,...b})}},bu=class extends q{constructor([a],b){let c=["script","flush"];a?.sync?c.push("sync"):a?.async&&c.push("async"),super(c,b)}},bv=class extends q{constructor(a,b){super(["script","load",...a],b)}},bw=class extends q{constructor(a,b){super(["sdiff",...a],b)}},bx=class extends q{constructor(a,b){super(["sdiffstore",...a],b)}},by=class extends q{constructor([a,b,c],d){let e=["set",a,b];c&&("nx"in c&&c.nx?e.push("nx"):"xx"in c&&c.xx&&e.push("xx"),"get"in c&&c.get&&e.push("get"),"ex"in c&&"number"==typeof c.ex?e.push("ex",c.ex):"px"in c&&"number"==typeof c.px?e.push("px",c.px):"exat"in c&&"number"==typeof c.exat?e.push("exat",c.exat):"pxat"in c&&"number"==typeof c.pxat?e.push("pxat",c.pxat):"keepTtl"in c&&c.keepTtl&&e.push("keepTtl")),super(e,d)}},bz=class extends q{constructor(a,b){super(["setbit",...a],b)}},bA=class extends q{constructor(a,b){super(["setex",...a],b)}},bB=class extends q{constructor(a,b){super(["setnx",...a],b)}},bC=class extends q{constructor(a,b){super(["setrange",...a],b)}},bD=class extends q{constructor(a,b){super(["sinter",...a],b)}},bE=class extends q{constructor(a,b){super(["sinterstore",...a],b)}},bF=class extends q{constructor(a,b){super(["sismember",...a],b)}},bG=class extends q{constructor(a,b){super(["smembers",...a],b)}},bH=class extends q{constructor(a,b){super(["smismember",a[0],...a[1]],b)}},bI=class extends q{constructor(a,b){super(["smove",...a],b)}},bJ=class extends q{constructor([a,b],c){let d=["spop",a];"number"==typeof b&&d.push(b),super(d,c)}},bK=class extends q{constructor([a,b],c){let d=["srandmember",a];"number"==typeof b&&d.push(b),super(d,c)}},bL=class extends q{constructor(a,b){super(["srem",...a],b)}},bM=class extends q{constructor([a,b,c],d){let e=["sscan",a,b];c?.match&&e.push("match",c.match),"number"==typeof c?.count&&e.push("count",c.count),super(e,{deserialize:j,...d})}},bN=class extends q{constructor(a,b){super(["strlen",...a],b)}},bO=class extends q{constructor(a,b){super(["sunion",...a],b)}},bP=class extends q{constructor(a,b){super(["sunionstore",...a],b)}},bQ=class extends q{constructor(a){super(["time"],a)}},bR=class extends q{constructor(a,b){super(["touch",...a],b)}},bS=class extends q{constructor(a,b){super(["ttl",...a],b)}},bT=class extends q{constructor(a,b){super(["type",...a],b)}},bU=class extends q{constructor(a,b){super(["unlink",...a],b)}},bV=class extends q{constructor([a,b,c],d){super(["XACK",a,b,...Array.isArray(c)?[...c]:[c]],d)}},bW=class extends q{constructor([a,b,c,d],e){let f=["XADD",a];for(let[a,e]of(d&&(d.nomkStream&&f.push("NOMKSTREAM"),d.trim&&(f.push(d.trim.type,d.trim.comparison,d.trim.threshold),void 0!==d.trim.limit&&f.push("LIMIT",d.trim.limit))),f.push(b),Object.entries(c)))f.push(a,e);super(f,e)}},bX=class extends q{constructor([a,b,c,d,e,f],g){let h=[];f?.count&&h.push("COUNT",f.count),f?.justId&&h.push("JUSTID"),super(["XAUTOCLAIM",a,b,c,d,e,...h],g)}},bY=class extends q{constructor([a,b,c,d,e,f],g){let h=Array.isArray(e)?[...e]:[e],i=[];f?.idleMS&&i.push("IDLE",f.idleMS),f?.idleMS&&i.push("TIME",f.timeMS),f?.retryCount&&i.push("RETRYCOUNT",f.retryCount),f?.force&&i.push("FORCE"),f?.justId&&i.push("JUSTID"),f?.lastId&&i.push("LASTID",f.lastId),super(["XCLAIM",a,b,c,d,...h,...i],g)}},bZ=class extends q{constructor([a,b],c){super(["XDEL",a,...Array.isArray(b)?[...b]:[b]],c)}},b$=class extends q{constructor([a,b],c){let d=["XGROUP"];switch(b.type){case"CREATE":d.push("CREATE",a,b.group,b.id),b.options&&(b.options.MKSTREAM&&d.push("MKSTREAM"),void 0!==b.options.ENTRIESREAD&&d.push("ENTRIESREAD",b.options.ENTRIESREAD.toString()));break;case"CREATECONSUMER":d.push("CREATECONSUMER",a,b.group,b.consumer);break;case"DELCONSUMER":d.push("DELCONSUMER",a,b.group,b.consumer);break;case"DESTROY":d.push("DESTROY",a,b.group);break;case"SETID":d.push("SETID",a,b.group,b.id),b.options?.ENTRIESREAD!==void 0&&d.push("ENTRIESREAD",b.options.ENTRIESREAD.toString());break;default:throw Error("Invalid XGROUP")}super(d,c)}},b_=class extends q{constructor([a,b],c){let d=[];"CONSUMERS"===b.type?d.push("CONSUMERS",a,b.group):d.push("GROUPS",a),super(["XINFO",...d],c)}},b0=class extends q{constructor(a,b){super(["XLEN",...a],b)}},b1=class extends q{constructor([a,b,c,d,e,f],g){super(["XPENDING",a,b,...f?.idleTime?["IDLE",f.idleTime]:[],c,d,e,...f?.consumer===void 0?[]:Array.isArray(f.consumer)?[...f.consumer]:[f.consumer]],g)}},b2=class extends q{constructor([a,b,c,d],e){let f=["XRANGE",a,b,c];"number"==typeof d&&f.push("COUNT",d),super(f,{deserialize:a=>(function(a){let b={};for(let c of a)for(let a=0;a<c.length;a+=2){let d=c[a],e=c[a+1];d in b||(b[d]={});for(let a=0;a<e.length;a+=2){let c=e[a],f=e[a+1];try{b[d][c]=JSON.parse(f)}catch{b[d][c]=f}}}return b})(a),...e})}},b3=class extends q{constructor([a,b,c],d){if(Array.isArray(a)&&Array.isArray(b)&&a.length!==b.length)throw Error("ERR Unbalanced XREAD list of streams: for each stream key an ID or '$' must be specified");let e=[];"number"==typeof c?.count&&e.push("COUNT",c.count),"number"==typeof c?.blockMS&&e.push("BLOCK",c.blockMS),e.push("STREAMS",...Array.isArray(a)?[...a]:[a],...Array.isArray(b)?[...b]:[b]),super(["XREAD",...e],d)}},b4=class extends q{constructor([a,b,c,d,e],f){if(Array.isArray(c)&&Array.isArray(d)&&c.length!==d.length)throw Error("ERR Unbalanced XREADGROUP list of streams: for each stream key an ID or '$' must be specified");let g=[];"number"==typeof e?.count&&g.push("COUNT",e.count),"number"==typeof e?.blockMS&&g.push("BLOCK",e.blockMS),"boolean"==typeof e?.NOACK&&e.NOACK&&g.push("NOACK"),g.push("STREAMS",...Array.isArray(c)?[...c]:[c],...Array.isArray(d)?[...d]:[d]),super(["XREADGROUP","GROUP",a,b,...g],f)}},b5=class extends q{constructor([a,b,c,d],e){let f=["XREVRANGE",a,b,c];"number"==typeof d&&f.push("COUNT",d),super(f,{deserialize:a=>(function(a){let b={};for(let c of a)for(let a=0;a<c.length;a+=2){let d=c[a],e=c[a+1];d in b||(b[d]={});for(let a=0;a<e.length;a+=2){let c=e[a],f=e[a+1];try{b[d][c]=JSON.parse(f)}catch{b[d][c]=f}}}return b})(a),...e})}},b6=class extends q{constructor([a,b],c){let{limit:d,strategy:e,threshold:f,exactness:g="~"}=b;super(["XTRIM",a,e,g,f,...d?["LIMIT",d]:[]],c)}},b7=class extends q{constructor([a,b,...c],d){let e=["zadd",a];"nx"in b&&b.nx?e.push("nx"):"xx"in b&&b.xx&&e.push("xx"),"ch"in b&&b.ch&&e.push("ch"),"incr"in b&&b.incr&&e.push("incr"),"lt"in b&&b.lt?e.push("lt"):"gt"in b&&b.gt&&e.push("gt"),"score"in b&&"member"in b&&e.push(b.score,b.member),e.push(...c.flatMap(({score:a,member:b})=>[a,b])),super(e,d)}},b8=class extends q{constructor(a,b){super(["zcard",...a],b)}},b9=class extends q{constructor(a,b){super(["zcount",...a],b)}},ca=class extends q{constructor(a,b){super(["zincrby",...a],b)}},cb=class extends q{constructor([a,b,c,d],e){let f=["zinterstore",a,b];Array.isArray(c)?f.push(...c):f.push(c),d&&("weights"in d&&d.weights?f.push("weights",...d.weights):"weight"in d&&"number"==typeof d.weight&&f.push("weights",d.weight),"aggregate"in d&&f.push("aggregate",d.aggregate)),super(f,e)}},cc=class extends q{constructor(a,b){super(["zlexcount",...a],b)}},cd=class extends q{constructor([a,b],c){let d=["zpopmax",a];"number"==typeof b&&d.push(b),super(d,c)}},ce=class extends q{constructor([a,b],c){let d=["zpopmin",a];"number"==typeof b&&d.push(b),super(d,c)}},cf=class extends q{constructor([a,b,c,d],e){let f=["zrange",a,b,c];d?.byScore&&f.push("byscore"),d?.byLex&&f.push("bylex"),d?.rev&&f.push("rev"),d?.count!==void 0&&void 0!==d.offset&&f.push("limit",d.offset,d.count),d?.withScores&&f.push("withscores"),super(f,e)}},cg=class extends q{constructor(a,b){super(["zrank",...a],b)}},ch=class extends q{constructor(a,b){super(["zrem",...a],b)}},ci=class extends q{constructor(a,b){super(["zremrangebylex",...a],b)}},cj=class extends q{constructor(a,b){super(["zremrangebyrank",...a],b)}},ck=class extends q{constructor(a,b){super(["zremrangebyscore",...a],b)}},cl=class extends q{constructor(a,b){super(["zrevrank",...a],b)}},cm=class extends q{constructor([a,b,c],d){let e=["zscan",a,b];c?.match&&e.push("match",c.match),"number"==typeof c?.count&&e.push("count",c.count),super(e,{deserialize:j,...d})}},cn=class extends q{constructor(a,b){super(["zscore",...a],b)}},co=class extends q{constructor([a,b,c],d){let e=["zunion",a];Array.isArray(b)?e.push(...b):e.push(b),c&&("weights"in c&&c.weights?e.push("weights",...c.weights):"weight"in c&&"number"==typeof c.weight&&e.push("weights",c.weight),"aggregate"in c&&e.push("aggregate",c.aggregate),c.withScores&&e.push("withscores")),super(e,d)}},cp=class extends q{constructor([a,b,c,d],e){let f=["zunionstore",a,b];Array.isArray(c)?f.push(...c):f.push(c),d&&("weights"in d&&d.weights?f.push("weights",...d.weights):"weight"in d&&"number"==typeof d.weight&&f.push("weights",d.weight),"aggregate"in d&&f.push("aggregate",d.aggregate)),super(f,e)}},cq=class extends q{constructor(a,b){super(["zdiffstore",...a],b)}},cr=class extends q{constructor(a,b){let[c,d]=a;super(["zmscore",c,...d],b)}},cs=class{client;commands;commandOptions;multiExec;constructor(a){if(this.client=a.client,this.commands=[],this.commandOptions=a.commandOptions,this.multiExec=a.multiExec??!1,this.commandOptions?.latencyLogging){let a=this.exec.bind(this);this.exec=async b=>{let c=performance.now(),d=await (b?a(b):a()),e=(performance.now()-c).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.multiExec?["MULTI-EXEC"]:["PIPELINE"].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${e} ms\x1b[0m`),d}}}exec=async a=>{if(0===this.commands.length)throw Error("Pipeline is empty");let b=this.multiExec?["multi-exec"]:["pipeline"],c=await this.client.request({path:b,body:Object.values(this.commands).map(a=>a.command)});return a?.keepErrors?c.map(({error:a,result:b},c)=>({error:a,result:this.commands[c].deserialize(b)})):c.map(({error:a,result:b},c)=>{if(a)throw new g(`Command ${c+1} [ ${this.commands[c].command[0]} ] failed: ${a}`);return this.commands[c].deserialize(b)})};length(){return this.commands.length}chain(a){return this.commands.push(a),this}append=(...a)=>this.chain(new s(a,this.commandOptions));bitcount=(...a)=>this.chain(new t(a,this.commandOptions));bitfield=(...a)=>new u(a,this.client,this.commandOptions,this.chain.bind(this));bitop=(a,b,c,...d)=>this.chain(new v([a,b,c,...d],this.commandOptions));bitpos=(...a)=>this.chain(new w(a,this.commandOptions));copy=(...a)=>this.chain(new x(a,this.commandOptions));zdiffstore=(...a)=>this.chain(new cq(a,this.commandOptions));dbsize=()=>this.chain(new y(this.commandOptions));decr=(...a)=>this.chain(new z(a,this.commandOptions));decrby=(...a)=>this.chain(new A(a,this.commandOptions));del=(...a)=>this.chain(new B(a,this.commandOptions));echo=(...a)=>this.chain(new C(a,this.commandOptions));evalRo=(...a)=>this.chain(new D(a,this.commandOptions));eval=(...a)=>this.chain(new E(a,this.commandOptions));evalshaRo=(...a)=>this.chain(new F(a,this.commandOptions));evalsha=(...a)=>this.chain(new G(a,this.commandOptions));exists=(...a)=>this.chain(new I(a,this.commandOptions));expire=(...a)=>this.chain(new J(a,this.commandOptions));expireat=(...a)=>this.chain(new K(a,this.commandOptions));flushall=a=>this.chain(new L(a,this.commandOptions));flushdb=(...a)=>this.chain(new M(a,this.commandOptions));geoadd=(...a)=>this.chain(new N(a,this.commandOptions));geodist=(...a)=>this.chain(new O(a,this.commandOptions));geopos=(...a)=>this.chain(new Q(a,this.commandOptions));geohash=(...a)=>this.chain(new P(a,this.commandOptions));geosearch=(...a)=>this.chain(new R(a,this.commandOptions));geosearchstore=(...a)=>this.chain(new S(a,this.commandOptions));get=(...a)=>this.chain(new T(a,this.commandOptions));getbit=(...a)=>this.chain(new U(a,this.commandOptions));getdel=(...a)=>this.chain(new V(a,this.commandOptions));getex=(...a)=>this.chain(new W(a,this.commandOptions));getrange=(...a)=>this.chain(new X(a,this.commandOptions));getset=(a,b)=>this.chain(new Y([a,b],this.commandOptions));hdel=(...a)=>this.chain(new Z(a,this.commandOptions));hexists=(...a)=>this.chain(new $(a,this.commandOptions));hexpire=(...a)=>this.chain(new _(a,this.commandOptions));hexpireat=(...a)=>this.chain(new aa(a,this.commandOptions));hexpiretime=(...a)=>this.chain(new ab(a,this.commandOptions));httl=(...a)=>this.chain(new at(a,this.commandOptions));hpexpire=(...a)=>this.chain(new ad(a,this.commandOptions));hpexpireat=(...a)=>this.chain(new ae(a,this.commandOptions));hpexpiretime=(...a)=>this.chain(new af(a,this.commandOptions));hpttl=(...a)=>this.chain(new ag(a,this.commandOptions));hpersist=(...a)=>this.chain(new ac(a,this.commandOptions));hget=(...a)=>this.chain(new ah(a,this.commandOptions));hgetall=(...a)=>this.chain(new ai(a,this.commandOptions));hincrby=(...a)=>this.chain(new aj(a,this.commandOptions));hincrbyfloat=(...a)=>this.chain(new ak(a,this.commandOptions));hkeys=(...a)=>this.chain(new al(a,this.commandOptions));hlen=(...a)=>this.chain(new am(a,this.commandOptions));hmget=(...a)=>this.chain(new an(a,this.commandOptions));hmset=(a,b)=>this.chain(new ao([a,b],this.commandOptions));hrandfield=(a,b,c)=>this.chain(new r([a,b,c],this.commandOptions));hscan=(...a)=>this.chain(new ap(a,this.commandOptions));hset=(a,b)=>this.chain(new aq([a,b],this.commandOptions));hsetnx=(a,b,c)=>this.chain(new ar([a,b,c],this.commandOptions));hstrlen=(...a)=>this.chain(new as(a,this.commandOptions));hvals=(...a)=>this.chain(new au(a,this.commandOptions));incr=(...a)=>this.chain(new av(a,this.commandOptions));incrby=(...a)=>this.chain(new aw(a,this.commandOptions));incrbyfloat=(...a)=>this.chain(new ax(a,this.commandOptions));keys=(...a)=>this.chain(new aV(a,this.commandOptions));lindex=(...a)=>this.chain(new aW(a,this.commandOptions));linsert=(a,b,c,d)=>this.chain(new aX([a,b,c,d],this.commandOptions));llen=(...a)=>this.chain(new aY(a,this.commandOptions));lmove=(...a)=>this.chain(new aZ(a,this.commandOptions));lpop=(...a)=>this.chain(new a_(a,this.commandOptions));lmpop=(...a)=>this.chain(new a$(a,this.commandOptions));lpos=(...a)=>this.chain(new a0(a,this.commandOptions));lpush=(a,...b)=>this.chain(new a1([a,...b],this.commandOptions));lpushx=(a,...b)=>this.chain(new a2([a,...b],this.commandOptions));lrange=(...a)=>this.chain(new a3(a,this.commandOptions));lrem=(a,b,c)=>this.chain(new a4([a,b,c],this.commandOptions));lset=(a,b,c)=>this.chain(new a5([a,b,c],this.commandOptions));ltrim=(...a)=>this.chain(new a6(a,this.commandOptions));mget=(...a)=>this.chain(new a7(a,this.commandOptions));mset=a=>this.chain(new a8([a],this.commandOptions));msetnx=a=>this.chain(new a9([a],this.commandOptions));persist=(...a)=>this.chain(new ba(a,this.commandOptions));pexpire=(...a)=>this.chain(new bb(a,this.commandOptions));pexpireat=(...a)=>this.chain(new bc(a,this.commandOptions));pfadd=(...a)=>this.chain(new bd(a,this.commandOptions));pfcount=(...a)=>this.chain(new be(a,this.commandOptions));pfmerge=(...a)=>this.chain(new bf(a,this.commandOptions));ping=a=>this.chain(new bg(a,this.commandOptions));psetex=(a,b,c)=>this.chain(new bh([a,b,c],this.commandOptions));pttl=(...a)=>this.chain(new bi(a,this.commandOptions));publish=(...a)=>this.chain(new bj(a,this.commandOptions));randomkey=()=>this.chain(new bk(this.commandOptions));rename=(...a)=>this.chain(new bl(a,this.commandOptions));renamenx=(...a)=>this.chain(new bm(a,this.commandOptions));rpop=(...a)=>this.chain(new bn(a,this.commandOptions));rpush=(a,...b)=>this.chain(new bo([a,...b],this.commandOptions));rpushx=(a,...b)=>this.chain(new bp([a,...b],this.commandOptions));sadd=(a,b,...c)=>this.chain(new bq([a,b,...c],this.commandOptions));scan=(...a)=>this.chain(new br(a,this.commandOptions));scard=(...a)=>this.chain(new bs(a,this.commandOptions));scriptExists=(...a)=>this.chain(new bt(a,this.commandOptions));scriptFlush=(...a)=>this.chain(new bu(a,this.commandOptions));scriptLoad=(...a)=>this.chain(new bv(a,this.commandOptions));sdiff=(...a)=>this.chain(new bw(a,this.commandOptions));sdiffstore=(...a)=>this.chain(new bx(a,this.commandOptions));set=(a,b,c)=>this.chain(new by([a,b,c],this.commandOptions));setbit=(...a)=>this.chain(new bz(a,this.commandOptions));setex=(a,b,c)=>this.chain(new bA([a,b,c],this.commandOptions));setnx=(a,b)=>this.chain(new bB([a,b],this.commandOptions));setrange=(...a)=>this.chain(new bC(a,this.commandOptions));sinter=(...a)=>this.chain(new bD(a,this.commandOptions));sinterstore=(...a)=>this.chain(new bE(a,this.commandOptions));sismember=(a,b)=>this.chain(new bF([a,b],this.commandOptions));smembers=(...a)=>this.chain(new bG(a,this.commandOptions));smismember=(a,b)=>this.chain(new bH([a,b],this.commandOptions));smove=(a,b,c)=>this.chain(new bI([a,b,c],this.commandOptions));spop=(...a)=>this.chain(new bJ(a,this.commandOptions));srandmember=(...a)=>this.chain(new bK(a,this.commandOptions));srem=(a,...b)=>this.chain(new bL([a,...b],this.commandOptions));sscan=(...a)=>this.chain(new bM(a,this.commandOptions));strlen=(...a)=>this.chain(new bN(a,this.commandOptions));sunion=(...a)=>this.chain(new bO(a,this.commandOptions));sunionstore=(...a)=>this.chain(new bP(a,this.commandOptions));time=()=>this.chain(new bQ(this.commandOptions));touch=(...a)=>this.chain(new bR(a,this.commandOptions));ttl=(...a)=>this.chain(new bS(a,this.commandOptions));type=(...a)=>this.chain(new bT(a,this.commandOptions));unlink=(...a)=>this.chain(new bU(a,this.commandOptions));zadd=(...a)=>("score"in a[1],this.chain(new b7([a[0],a[1],...a.slice(2)],this.commandOptions)));xadd=(...a)=>this.chain(new bW(a,this.commandOptions));xack=(...a)=>this.chain(new bV(a,this.commandOptions));xdel=(...a)=>this.chain(new bZ(a,this.commandOptions));xgroup=(...a)=>this.chain(new b$(a,this.commandOptions));xread=(...a)=>this.chain(new b3(a,this.commandOptions));xreadgroup=(...a)=>this.chain(new b4(a,this.commandOptions));xinfo=(...a)=>this.chain(new b_(a,this.commandOptions));xlen=(...a)=>this.chain(new b0(a,this.commandOptions));xpending=(...a)=>this.chain(new b1(a,this.commandOptions));xclaim=(...a)=>this.chain(new bY(a,this.commandOptions));xautoclaim=(...a)=>this.chain(new bX(a,this.commandOptions));xtrim=(...a)=>this.chain(new b6(a,this.commandOptions));xrange=(...a)=>this.chain(new b2(a,this.commandOptions));xrevrange=(...a)=>this.chain(new b5(a,this.commandOptions));zcard=(...a)=>this.chain(new b8(a,this.commandOptions));zcount=(...a)=>this.chain(new b9(a,this.commandOptions));zincrby=(a,b,c)=>this.chain(new ca([a,b,c],this.commandOptions));zinterstore=(...a)=>this.chain(new cb(a,this.commandOptions));zlexcount=(...a)=>this.chain(new cc(a,this.commandOptions));zmscore=(...a)=>this.chain(new cr(a,this.commandOptions));zpopmax=(...a)=>this.chain(new cd(a,this.commandOptions));zpopmin=(...a)=>this.chain(new ce(a,this.commandOptions));zrange=(...a)=>this.chain(new cf(a,this.commandOptions));zrank=(a,b)=>this.chain(new cg([a,b],this.commandOptions));zrem=(a,...b)=>this.chain(new ch([a,...b],this.commandOptions));zremrangebylex=(...a)=>this.chain(new ci(a,this.commandOptions));zremrangebyrank=(...a)=>this.chain(new cj(a,this.commandOptions));zremrangebyscore=(...a)=>this.chain(new ck(a,this.commandOptions));zrevrank=(a,b)=>this.chain(new cl([a,b],this.commandOptions));zscan=(...a)=>this.chain(new cm(a,this.commandOptions));zscore=(a,b)=>this.chain(new cn([a,b],this.commandOptions));zunionstore=(...a)=>this.chain(new cp(a,this.commandOptions));zunion=(...a)=>this.chain(new co(a,this.commandOptions));get json(){return{arrappend:(...a)=>this.chain(new ay(a,this.commandOptions)),arrindex:(...a)=>this.chain(new az(a,this.commandOptions)),arrinsert:(...a)=>this.chain(new aA(a,this.commandOptions)),arrlen:(...a)=>this.chain(new aB(a,this.commandOptions)),arrpop:(...a)=>this.chain(new aC(a,this.commandOptions)),arrtrim:(...a)=>this.chain(new aD(a,this.commandOptions)),clear:(...a)=>this.chain(new aE(a,this.commandOptions)),del:(...a)=>this.chain(new aF(a,this.commandOptions)),forget:(...a)=>this.chain(new aG(a,this.commandOptions)),get:(...a)=>this.chain(new aH(a,this.commandOptions)),merge:(...a)=>this.chain(new aI(a,this.commandOptions)),mget:(...a)=>this.chain(new aJ(a,this.commandOptions)),mset:(...a)=>this.chain(new aK(a,this.commandOptions)),numincrby:(...a)=>this.chain(new aL(a,this.commandOptions)),nummultby:(...a)=>this.chain(new aM(a,this.commandOptions)),objkeys:(...a)=>this.chain(new aN(a,this.commandOptions)),objlen:(...a)=>this.chain(new aO(a,this.commandOptions)),resp:(...a)=>this.chain(new aP(a,this.commandOptions)),set:(...a)=>this.chain(new aQ(a,this.commandOptions)),strappend:(...a)=>this.chain(new aR(a,this.commandOptions)),strlen:(...a)=>this.chain(new aS(a,this.commandOptions)),toggle:(...a)=>this.chain(new aT(a,this.commandOptions)),type:(...a)=>this.chain(new aU(a,this.commandOptions))}}},ct=new Set(["scan","keys","flushdb","flushall","dbsize","hscan","hgetall","hkeys","lrange","sscan","smembers","xrange","xrevrange","zscan","zrange","exec"]),cu=class{pipelinePromises=new WeakMap;activePipeline=null;indexInCurrentPipeline=0;redis;pipeline;pipelineCounter=0;constructor(a){this.redis=a,this.pipeline=a.pipeline()}async withAutoPipeline(a){let b=this.activePipeline??this.redis.pipeline();this.activePipeline||(this.activePipeline=b,this.indexInCurrentPipeline=0);let c=this.indexInCurrentPipeline++;a(b);let d=this.deferExecution().then(()=>{if(!this.pipelinePromises.has(b)){let a=b.exec({keepErrors:!0});this.pipelineCounter+=1,this.pipelinePromises.set(b,a),this.activePipeline=null}return this.pipelinePromises.get(b)}),e=(await d)[c];if(e.error)throw new g(`Command failed: ${e.error}`);return e.result}async deferExecution(){await Promise.resolve(),await Promise.resolve()}},cv=class extends q{constructor(a,b){super([],{...b,headers:{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"},path:["psubscribe",...a],streamOptions:{isStreaming:!0,onMessage:b?.streamOptions?.onMessage,signal:b?.streamOptions?.signal}})}},cw=class extends EventTarget{subscriptions;client;listeners;constructor(a,b,c=!1){for(let d of(super(),this.client=a,this.subscriptions=new Map,this.listeners=new Map,b))c?this.subscribeToPattern(d):this.subscribeToChannel(d)}subscribeToChannel(a){let b=new AbortController,c=new cx([a],{streamOptions:{signal:b.signal,onMessage:a=>this.handleMessage(a,!1)}});c.exec(this.client).catch(a=>{"AbortError"!==a.name&&this.dispatchToListeners("error",a)}),this.subscriptions.set(a,{command:c,controller:b,isPattern:!1})}subscribeToPattern(a){let b=new AbortController,c=new cv([a],{streamOptions:{signal:b.signal,onMessage:a=>this.handleMessage(a,!0)}});c.exec(this.client).catch(a=>{"AbortError"!==a.name&&this.dispatchToListeners("error",a)}),this.subscriptions.set(a,{command:c,controller:b,isPattern:!0})}handleMessage(a,b){let c=a.replace(/^data:\s*/,""),d=c.indexOf(","),e=c.indexOf(",",d+1),f=b?c.indexOf(",",e+1):-1;if(-1!==d&&-1!==e){let a=c.slice(0,d);if(b&&"pmessage"===a&&-1!==f){let a=c.slice(d+1,e),b=c.slice(e+1,f),g=c.slice(f+1);try{let c=JSON.parse(g);this.dispatchToListeners("pmessage",{pattern:a,channel:b,message:c}),this.dispatchToListeners(`pmessage:${a}`,{pattern:a,channel:b,message:c})}catch(a){this.dispatchToListeners("error",Error(`Failed to parse message: ${a}`))}}else{let b=c.slice(d+1,e),f=c.slice(e+1);try{if("subscribe"===a||"psubscribe"===a||"unsubscribe"===a||"punsubscribe"===a){let b=Number.parseInt(f);this.dispatchToListeners(a,b)}else{let c=JSON.parse(f);this.dispatchToListeners(a,{channel:b,message:c}),this.dispatchToListeners(`${a}:${b}`,{channel:b,message:c})}}catch(a){this.dispatchToListeners("error",Error(`Failed to parse message: ${a}`))}}}}dispatchToListeners(a,b){let c=this.listeners.get(a);if(c)for(let a of c)a(b)}on(a,b){this.listeners.has(a)||this.listeners.set(a,new Set),this.listeners.get(a)?.add(b)}removeAllListeners(){this.listeners.clear()}async unsubscribe(a){if(a)for(let b of a){let a=this.subscriptions.get(b);if(a){try{a.controller.abort()}catch{}this.subscriptions.delete(b)}}else{for(let a of this.subscriptions.values())try{a.controller.abort()}catch{}this.subscriptions.clear(),this.removeAllListeners()}}getSubscribedChannels(){return[...this.subscriptions.keys()]}},cx=class extends q{constructor(a,b){super([],{...b,headers:{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"},path:["subscribe",...a],streamOptions:{isStreaming:!0,onMessage:b?.streamOptions?.onMessage,signal:b?.streamOptions?.signal}})}},cy=class{script;sha1;redis;constructor(a,b){this.redis=a,this.script=b,this.sha1="",this.init(b)}async init(a){this.sha1||(this.sha1=await this.digest(a))}async eval(a,b){return await this.init(this.script),await this.redis.eval(this.script,a,b)}async evalsha(a,b){return await this.init(this.script),await this.redis.evalsha(this.sha1,a,b)}async exec(a,b){return await this.init(this.script),await this.redis.evalsha(this.sha1,a,b).catch(async c=>{if(c instanceof Error&&c.message.toLowerCase().includes("noscript"))return await this.redis.eval(this.script,a,b);throw c})}async digest(a){let b=new TextEncoder().encode(a);return[...new Uint8Array(await e.digest("SHA-1",b))].map(a=>a.toString(16).padStart(2,"0")).join("")}},cz=class{script;sha1;redis;constructor(a,b){this.redis=a,this.sha1="",this.script=b,this.init(b)}async init(a){this.sha1||(this.sha1=await this.digest(a))}async evalRo(a,b){return await this.init(this.script),await this.redis.evalRo(this.script,a,b)}async evalshaRo(a,b){return await this.init(this.script),await this.redis.evalshaRo(this.sha1,a,b)}async exec(a,b){return await this.init(this.script),await this.redis.evalshaRo(this.sha1,a,b).catch(async c=>{if(c instanceof Error&&c.message.toLowerCase().includes("noscript"))return await this.redis.evalRo(this.script,a,b);throw c})}async digest(a){let b=new TextEncoder().encode(a);return[...new Uint8Array(await e.digest("SHA-1",b))].map(a=>a.toString(16).padStart(2,"0")).join("")}},cA=class{client;opts;enableTelemetry;enableAutoPipelining;constructor(a,b){this.client=a,this.opts=b,this.enableTelemetry=b?.enableTelemetry??!0,b?.readYourWrites===!1&&(this.client.readYourWrites=!1),this.enableAutoPipelining=b?.enableAutoPipelining??!0}get readYourWritesSyncToken(){return this.client.upstashSyncToken}set readYourWritesSyncToken(a){this.client.upstashSyncToken=a}get json(){return{arrappend:(...a)=>new ay(a,this.opts).exec(this.client),arrindex:(...a)=>new az(a,this.opts).exec(this.client),arrinsert:(...a)=>new aA(a,this.opts).exec(this.client),arrlen:(...a)=>new aB(a,this.opts).exec(this.client),arrpop:(...a)=>new aC(a,this.opts).exec(this.client),arrtrim:(...a)=>new aD(a,this.opts).exec(this.client),clear:(...a)=>new aE(a,this.opts).exec(this.client),del:(...a)=>new aF(a,this.opts).exec(this.client),forget:(...a)=>new aG(a,this.opts).exec(this.client),get:(...a)=>new aH(a,this.opts).exec(this.client),merge:(...a)=>new aI(a,this.opts).exec(this.client),mget:(...a)=>new aJ(a,this.opts).exec(this.client),mset:(...a)=>new aK(a,this.opts).exec(this.client),numincrby:(...a)=>new aL(a,this.opts).exec(this.client),nummultby:(...a)=>new aM(a,this.opts).exec(this.client),objkeys:(...a)=>new aN(a,this.opts).exec(this.client),objlen:(...a)=>new aO(a,this.opts).exec(this.client),resp:(...a)=>new aP(a,this.opts).exec(this.client),set:(...a)=>new aQ(a,this.opts).exec(this.client),strappend:(...a)=>new aR(a,this.opts).exec(this.client),strlen:(...a)=>new aS(a,this.opts).exec(this.client),toggle:(...a)=>new aT(a,this.opts).exec(this.client),type:(...a)=>new aU(a,this.opts).exec(this.client)}}use=a=>{let b=this.client.request.bind(this.client);this.client.request=c=>a(c,b)};addTelemetry=a=>{if(this.enableTelemetry)try{this.client.mergeTelemetry(a)}catch{}};createScript(a,b){return b?.readonly?new cz(this,a):new cy(this,a)}pipeline=()=>new cs({client:this.client,commandOptions:this.opts,multiExec:!1});autoPipeline=()=>(function a(b,c){return b.autoPipelineExecutor||(b.autoPipelineExecutor=new cu(b)),new Proxy(b,{get:(b,d)=>{if("pipelineCounter"===d)return b.autoPipelineExecutor.pipelineCounter;if("json"===d)return a(b,!0);let e=d in b&&!(d in b.autoPipelineExecutor.pipeline),f=ct.has(d);return e||f?b[d]:(c?"function"==typeof b.autoPipelineExecutor.pipeline.json[d]:"function"==typeof b.autoPipelineExecutor.pipeline[d])?(...a)=>b.autoPipelineExecutor.withAutoPipeline(b=>{c?b.json[d](...a):b[d](...a)}):b.autoPipelineExecutor.pipeline[d]}})})(this);multi=()=>new cs({client:this.client,commandOptions:this.opts,multiExec:!0});bitfield=(...a)=>new u(a,this.client,this.opts);append=(...a)=>new s(a,this.opts).exec(this.client);bitcount=(...a)=>new t(a,this.opts).exec(this.client);bitop=(a,b,c,...d)=>new v([a,b,c,...d],this.opts).exec(this.client);bitpos=(...a)=>new w(a,this.opts).exec(this.client);copy=(...a)=>new x(a,this.opts).exec(this.client);dbsize=()=>new y(this.opts).exec(this.client);decr=(...a)=>new z(a,this.opts).exec(this.client);decrby=(...a)=>new A(a,this.opts).exec(this.client);del=(...a)=>new B(a,this.opts).exec(this.client);echo=(...a)=>new C(a,this.opts).exec(this.client);evalRo=(...a)=>new D(a,this.opts).exec(this.client);eval=(...a)=>new E(a,this.opts).exec(this.client);evalshaRo=(...a)=>new F(a,this.opts).exec(this.client);evalsha=(...a)=>new G(a,this.opts).exec(this.client);exec=a=>new H(a,this.opts).exec(this.client);exists=(...a)=>new I(a,this.opts).exec(this.client);expire=(...a)=>new J(a,this.opts).exec(this.client);expireat=(...a)=>new K(a,this.opts).exec(this.client);flushall=a=>new L(a,this.opts).exec(this.client);flushdb=(...a)=>new M(a,this.opts).exec(this.client);geoadd=(...a)=>new N(a,this.opts).exec(this.client);geopos=(...a)=>new Q(a,this.opts).exec(this.client);geodist=(...a)=>new O(a,this.opts).exec(this.client);geohash=(...a)=>new P(a,this.opts).exec(this.client);geosearch=(...a)=>new R(a,this.opts).exec(this.client);geosearchstore=(...a)=>new S(a,this.opts).exec(this.client);get=(...a)=>new T(a,this.opts).exec(this.client);getbit=(...a)=>new U(a,this.opts).exec(this.client);getdel=(...a)=>new V(a,this.opts).exec(this.client);getex=(...a)=>new W(a,this.opts).exec(this.client);getrange=(...a)=>new X(a,this.opts).exec(this.client);getset=(a,b)=>new Y([a,b],this.opts).exec(this.client);hdel=(...a)=>new Z(a,this.opts).exec(this.client);hexists=(...a)=>new $(a,this.opts).exec(this.client);hexpire=(...a)=>new _(a,this.opts).exec(this.client);hexpireat=(...a)=>new aa(a,this.opts).exec(this.client);hexpiretime=(...a)=>new ab(a,this.opts).exec(this.client);httl=(...a)=>new at(a,this.opts).exec(this.client);hpexpire=(...a)=>new ad(a,this.opts).exec(this.client);hpexpireat=(...a)=>new ae(a,this.opts).exec(this.client);hpexpiretime=(...a)=>new af(a,this.opts).exec(this.client);hpttl=(...a)=>new ag(a,this.opts).exec(this.client);hpersist=(...a)=>new ac(a,this.opts).exec(this.client);hget=(...a)=>new ah(a,this.opts).exec(this.client);hgetall=(...a)=>new ai(a,this.opts).exec(this.client);hincrby=(...a)=>new aj(a,this.opts).exec(this.client);hincrbyfloat=(...a)=>new ak(a,this.opts).exec(this.client);hkeys=(...a)=>new al(a,this.opts).exec(this.client);hlen=(...a)=>new am(a,this.opts).exec(this.client);hmget=(...a)=>new an(a,this.opts).exec(this.client);hmset=(a,b)=>new ao([a,b],this.opts).exec(this.client);hrandfield=(a,b,c)=>new r([a,b,c],this.opts).exec(this.client);hscan=(...a)=>new ap(a,this.opts).exec(this.client);hset=(a,b)=>new aq([a,b],this.opts).exec(this.client);hsetnx=(a,b,c)=>new ar([a,b,c],this.opts).exec(this.client);hstrlen=(...a)=>new as(a,this.opts).exec(this.client);hvals=(...a)=>new au(a,this.opts).exec(this.client);incr=(...a)=>new av(a,this.opts).exec(this.client);incrby=(...a)=>new aw(a,this.opts).exec(this.client);incrbyfloat=(...a)=>new ax(a,this.opts).exec(this.client);keys=(...a)=>new aV(a,this.opts).exec(this.client);lindex=(...a)=>new aW(a,this.opts).exec(this.client);linsert=(a,b,c,d)=>new aX([a,b,c,d],this.opts).exec(this.client);llen=(...a)=>new aY(a,this.opts).exec(this.client);lmove=(...a)=>new aZ(a,this.opts).exec(this.client);lpop=(...a)=>new a_(a,this.opts).exec(this.client);lmpop=(...a)=>new a$(a,this.opts).exec(this.client);lpos=(...a)=>new a0(a,this.opts).exec(this.client);lpush=(a,...b)=>new a1([a,...b],this.opts).exec(this.client);lpushx=(a,...b)=>new a2([a,...b],this.opts).exec(this.client);lrange=(...a)=>new a3(a,this.opts).exec(this.client);lrem=(a,b,c)=>new a4([a,b,c],this.opts).exec(this.client);lset=(a,b,c)=>new a5([a,b,c],this.opts).exec(this.client);ltrim=(...a)=>new a6(a,this.opts).exec(this.client);mget=(...a)=>new a7(a,this.opts).exec(this.client);mset=a=>new a8([a],this.opts).exec(this.client);msetnx=a=>new a9([a],this.opts).exec(this.client);persist=(...a)=>new ba(a,this.opts).exec(this.client);pexpire=(...a)=>new bb(a,this.opts).exec(this.client);pexpireat=(...a)=>new bc(a,this.opts).exec(this.client);pfadd=(...a)=>new bd(a,this.opts).exec(this.client);pfcount=(...a)=>new be(a,this.opts).exec(this.client);pfmerge=(...a)=>new bf(a,this.opts).exec(this.client);ping=a=>new bg(a,this.opts).exec(this.client);psetex=(a,b,c)=>new bh([a,b,c],this.opts).exec(this.client);psubscribe=a=>{let b=Array.isArray(a)?a:[a];return new cw(this.client,b,!0)};pttl=(...a)=>new bi(a,this.opts).exec(this.client);publish=(...a)=>new bj(a,this.opts).exec(this.client);randomkey=()=>new bk().exec(this.client);rename=(...a)=>new bl(a,this.opts).exec(this.client);renamenx=(...a)=>new bm(a,this.opts).exec(this.client);rpop=(...a)=>new bn(a,this.opts).exec(this.client);rpush=(a,...b)=>new bo([a,...b],this.opts).exec(this.client);rpushx=(a,...b)=>new bp([a,...b],this.opts).exec(this.client);sadd=(a,b,...c)=>new bq([a,b,...c],this.opts).exec(this.client);scan(a,b){return new br([a,b],this.opts).exec(this.client)}scard=(...a)=>new bs(a,this.opts).exec(this.client);scriptExists=(...a)=>new bt(a,this.opts).exec(this.client);scriptFlush=(...a)=>new bu(a,this.opts).exec(this.client);scriptLoad=(...a)=>new bv(a,this.opts).exec(this.client);sdiff=(...a)=>new bw(a,this.opts).exec(this.client);sdiffstore=(...a)=>new bx(a,this.opts).exec(this.client);set=(a,b,c)=>new by([a,b,c],this.opts).exec(this.client);setbit=(...a)=>new bz(a,this.opts).exec(this.client);setex=(a,b,c)=>new bA([a,b,c],this.opts).exec(this.client);setnx=(a,b)=>new bB([a,b],this.opts).exec(this.client);setrange=(...a)=>new bC(a,this.opts).exec(this.client);sinter=(...a)=>new bD(a,this.opts).exec(this.client);sinterstore=(...a)=>new bE(a,this.opts).exec(this.client);sismember=(a,b)=>new bF([a,b],this.opts).exec(this.client);smismember=(a,b)=>new bH([a,b],this.opts).exec(this.client);smembers=(...a)=>new bG(a,this.opts).exec(this.client);smove=(a,b,c)=>new bI([a,b,c],this.opts).exec(this.client);spop=(...a)=>new bJ(a,this.opts).exec(this.client);srandmember=(...a)=>new bK(a,this.opts).exec(this.client);srem=(a,...b)=>new bL([a,...b],this.opts).exec(this.client);sscan=(...a)=>new bM(a,this.opts).exec(this.client);strlen=(...a)=>new bN(a,this.opts).exec(this.client);subscribe=a=>{let b=Array.isArray(a)?a:[a];return new cw(this.client,b)};sunion=(...a)=>new bO(a,this.opts).exec(this.client);sunionstore=(...a)=>new bP(a,this.opts).exec(this.client);time=()=>new bQ().exec(this.client);touch=(...a)=>new bR(a,this.opts).exec(this.client);ttl=(...a)=>new bS(a,this.opts).exec(this.client);type=(...a)=>new bT(a,this.opts).exec(this.client);unlink=(...a)=>new bU(a,this.opts).exec(this.client);xadd=(...a)=>new bW(a,this.opts).exec(this.client);xack=(...a)=>new bV(a,this.opts).exec(this.client);xdel=(...a)=>new bZ(a,this.opts).exec(this.client);xgroup=(...a)=>new b$(a,this.opts).exec(this.client);xread=(...a)=>new b3(a,this.opts).exec(this.client);xreadgroup=(...a)=>new b4(a,this.opts).exec(this.client);xinfo=(...a)=>new b_(a,this.opts).exec(this.client);xlen=(...a)=>new b0(a,this.opts).exec(this.client);xpending=(...a)=>new b1(a,this.opts).exec(this.client);xclaim=(...a)=>new bY(a,this.opts).exec(this.client);xautoclaim=(...a)=>new bX(a,this.opts).exec(this.client);xtrim=(...a)=>new b6(a,this.opts).exec(this.client);xrange=(...a)=>new b2(a,this.opts).exec(this.client);xrevrange=(...a)=>new b5(a,this.opts).exec(this.client);zadd=(...a)=>("score"in a[1],new b7([a[0],a[1],...a.slice(2)],this.opts).exec(this.client));zcard=(...a)=>new b8(a,this.opts).exec(this.client);zcount=(...a)=>new b9(a,this.opts).exec(this.client);zdiffstore=(...a)=>new cq(a,this.opts).exec(this.client);zincrby=(a,b,c)=>new ca([a,b,c],this.opts).exec(this.client);zinterstore=(...a)=>new cb(a,this.opts).exec(this.client);zlexcount=(...a)=>new cc(a,this.opts).exec(this.client);zmscore=(...a)=>new cr(a,this.opts).exec(this.client);zpopmax=(...a)=>new cd(a,this.opts).exec(this.client);zpopmin=(...a)=>new ce(a,this.opts).exec(this.client);zrange=(...a)=>new cf(a,this.opts).exec(this.client);zrank=(a,b)=>new cg([a,b],this.opts).exec(this.client);zrem=(a,...b)=>new ch([a,...b],this.opts).exec(this.client);zremrangebylex=(...a)=>new ci(a,this.opts).exec(this.client);zremrangebyrank=(...a)=>new cj(a,this.opts).exec(this.client);zremrangebyscore=(...a)=>new ck(a,this.opts).exec(this.client);zrevrank=(a,b)=>new cl([a,b],this.opts).exec(this.client);zscan=(...a)=>new cm(a,this.opts).exec(this.client);zscore=(a,b)=>new cn([a,b],this.opts).exec(this.client);zunion=(...a)=>new co(a,this.opts).exec(this.client);zunionstore=(...a)=>new cp(a,this.opts).exec(this.client)};"undefined"==typeof atob&&(global.atob=a=>Buffer.from(a,"base64").toString("utf8"));var cB=class a extends cA{constructor(a){if("request"in a)return void super(a);if(a.url?(a.url.startsWith(" ")||a.url.endsWith(" ")||/\r|\n/.test(a.url))&&console.warn("[Upstash Redis] The redis url contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'url' property is missing or undefined in your Redis config."),a.token?(a.token.startsWith(" ")||a.token.endsWith(" ")||/\r|\n/.test(a.token))&&console.warn("[Upstash Redis] The redis token contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'token' property is missing or undefined in your Redis config."),super(new l({baseUrl:a.url,retry:a.retry,headers:{authorization:`Bearer ${a.token}`},agent:a.agent,responseEncoding:a.responseEncoding,cache:a.cache??"no-store",signal:a.signal,keepAlive:a.keepAlive,readYourWrites:a.readYourWrites}),{automaticDeserialization:a.automaticDeserialization,enableTelemetry:!process.env.UPSTASH_DISABLE_TELEMETRY,latencyLogging:a.latencyLogging,enableAutoPipelining:a.enableAutoPipelining}),this.addTelemetry({runtime:"string"==typeof EdgeRuntime?"edge-light":`node@${process.version}`,platform:process.env.UPSTASH_CONSOLE?"console":process.env.VERCEL?"vercel":process.env.AWS_REGION?"aws":"unknown",sdk:"@upstash/redis@v1.35.3"}),this.enableAutoPipelining)return this.autoPipeline()}static fromEnv(b){if(void 0===process.env)throw TypeError('[Upstash Redis] Unable to get environment variables, `process.env` is undefined. If you are deploying to cloudflare, please import from "@upstash/redis/cloudflare" instead');let c=process.env.UPSTASH_REDIS_REST_URL||process.env.KV_REST_API_URL;c||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_URL`");let d=process.env.UPSTASH_REDIS_REST_TOKEN||process.env.KV_REST_API_TOKEN;return d||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_TOKEN`"),new a({...b,url:c,token:d})}}}};